---
title: "Class-based network segregation, Economic Inequality and Redistributive Preferences across societies"
css: "input/css/custom.css" # custom CSS para html
fontsize: 12pt
linestretch: '1.15'          # interlineado 
papersize: a4
link-citations: yes         # citas linkeadas
lang: en-US
# date: "`r format(Sys.time(), '%A %d %B %Y %X')`"
date: "`r format(Sys.Date(), '%d %b %Y')`"
author:
- name: Julio Iturra-Sanhueza
#   affiliation: University of Bremen
#   email: jiturra@uni-bremen.de
#   number: 1
# - name: Justin d'Ottawa
#   affiliation: University of Ottawa
#   number: 2
# - name: Pedro Torres
#   number: 1,2 
# Nota: Autores que comparten filiacion, poner el mismo number y declarar filiación una sola vez.  
# abstract: |
#  The escalating economic inequality and the current sanitary crisis have threatened social cohesion among citizens. However, these consequences have been unevenly experienced across the social structure. The upper and intermediate classes, benefiting from privileged access to social resources, have shown resilience. Conversely, working-class families have faced deteriorating material conditions, leading to a heightened sense of marginalisation and increasing the demand for welfare support. Particularly, social resources through network ties have been suggested to have a direct link with an individual’s welfare through instrumental and expressive outcomes, such as providing information or help in moments of need. Consequently, inequalities in access to certain social positions (i.e. occupations) are translated into a lack of social resources beyond individual economic and cultural capital. Additionally, it has been argued that social isolation not only plays a role in terms of resources but given that higher levels of segregation can bolster opinions, it is argued that being isolated from other social classes can polarise attitudes mainly in the working and upper-middle classes. Employing data from the International Social Survey Programme - Social Networks  this research aims to understand to what extent the demand for redistribution is linked to social ties. To addresss this, ego-centred social networks are used to represent the degree of class-based homogeneity of social ties. The results of multilevel estimations show that being socially segregated increases demand for redistribution. Additionally, this influence is conditional to social class, where the working and intermediate classes with highly homogeneous networks demand more governmental redistribution than the upper class. At the macro level, as the current distribution of economic resources influences the opportunity structure, it has been hypothesised that income inequality could bolster the influence of social segregation on the demand for redistribution. However, cross-level interactions do not provide supporting evidence on this behalf. 
#    **Keywords**: network segregation, redistributive preferences, economic inequality 
output:
  bookdown::pdf_document2:
    template: null
    toc: false
    keep_tex: false
    number_sections: true
    pandoc_args:
      - --template=input/mytemplate.tex #custom template para usar autores con afiliacion  
  bookdown::html_document2:
    toc: yes
    code_folding: hide
    number_sections: false
    toc_float:
      collapsed: false
      smooth_scroll: false
         
always_allow_html: true      
linkcolor: gray                         # enlaces y citas en color azul
bibliography: input/bib/rgroup-redist.bib     # bibliografia en bibtex
csl: input/bib/apa6.csl
editor_options:
  chunk_output_type: console            # en RStudio, mostrar output en consola
geometry: "left=2.54cm,right=2.54cm,top=2.54cm,bottom=2.54cm" # márgenes de página
header-includes:
  - \usepackage{times}           # Times New Roman
  - \usepackage{caption}
  - \captionsetup[figure, table]{labelfont={bf},labelformat={default},labelsep=period}
  - \usepackage{graphicx}
  - \usepackage{float}
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \setlength\parindent{24pt} 
  - \usepackage{fancyhdr}
  - \fancyhead{} 
---

```{r eval=FALSE, include=FALSE}
 # for render in pdf run rmarkdown::render_site("docs/paper.Rmd", output_format = "all")
 # clean #in the yml
 rmarkdown::render("paper1_jiturra.Rmd", output_format = "bookdown::pdf_document2")
 rmarkdown::render("paper1_jiturra.Rmd", output_format = "bookdown::html_document2")
 rmarkdown::render("paper1_jiturra.Rmd", output_format = "bookdown::word_document2")
 
 # install.packages("trackdown")
 trackdown::update_file(file = "paper1_jiturra.Rmd", hide_code = TRUE,gpath = '001_PhD/002dissertation/paper1')
                        
```

<!-- - considerar ISEI08 como alternativa de social class por la correlacion con homogeneidad -->
<!-- - darle una oportunidad al h-index -->
<!--     - en general es prácticamente lo mismo que el indicador de homogeneidad -->
<!-- - controlaria por social activities index () -->
<!-- - social resources  -->
    
```{r setup, include=FALSE}
if (!require("pacman")) install.packages("pacman")  #si falta pacman, instalar
if (!require("tinytex")) install.packages("tinytex")#si falta tinytex, instalar
pacman::p_load(knitr, kableExtra, dplyr, ggplot2,sjmisc,texreg) # librerias
knitr::opts_chunk$set(warning = FALSE,  # mensaje de warning
                      message = FALSE,  # mensajes/avisos de librerias  
                      cache = F,    # cache de los chunks,usar analisis pesados
                      out.width = '100%',
                      fig.pos= "H",     # posicion figuras H = HERE
                      fig.align = "center",
                      echo = FALSE      # incluir chunk en output
                      )
options(scipen=999) # notacion cientifica
rm(list=ls())       # limpiar workspace
options(knitr.kable.NA = '') # NA en kable = ''
```
\pagestyle{fancy}
\fancyhead[R]{ \thepage}
\fancyhead[L]{Research Article Draft}

# Introduction  

Rising economic inequality over the past decades [@piketty_capital_2014] and the recent sanitary crisis have raised citizens' concerns about economic inequality, pushing governments to enact redistributive policies, which has tested the capacity of welfare systems to provide sufficient risk protection for their citizens [@breznau_welfare_2021]. However, the privileged access to resources held by the upper and intermediate classes has consolidated their resilience capacity in times of greater economic hardship, allowing them to maintain a relatively stable standard of living, in contrast to the decline in the material conditions of working-class families [@moawad_myth_2023]. In this regard, it has been claimed that economic gaps in economic resources also have a greater effect on social relations. Studies on the role of economic inequality have argued that social bonding can be threatened when economic inequality increases, undermines how people perceive each other, their opportunities to participate in social life, and the capacity to knit networks that contribute to social integration [@lancee_income_2012;@letki_getting_2015]. Therefore, experiencing segregated networks is one of the consequences of greater economic gaps as it represents greater distance between the different social classes  [@pichler_patterns_2007;@otero_space_2022]. In this regard, it has been argued that segregation can threaten social cohesion and solidarity [@joye_measuring_2019], which in turn can undermine public support for welfare schemes and redistribution [@baldassarri_diversity_2020]. 

The sociological tradition has understood social classes through the labor market situation of occupations in terms of employment relations, skill level, and authority within the workplace [@Erikson1992;@Erikson1979]. Likewise, classes represent relations in the labor market and trace lines in terms of status relations as the foundations for opportunities for action and the consolidation of lifestyles [@weber_economy_1978]. 
In this matter, the class situation of individuals and households also trace distinctions in various domains of social life, such as cultural consumption behavior [@Chan2007;@torche_social_2007], ideological preferences [@evans_decline_1993], and popular opinions about the welfare state and redistribution [@Svallfors2006]. Regarding the latter, despite the claims of a displacement of the distributive struggle between classes by other group identities [@clark_declining_1993;@inglehart_culture_1990], past decade research has persistently demonstrated that class positions indeed still explain economic attitudes towards the welfare state and redistribution [@lindh_class_2020, p. 421]. Thus, the claimed blurring of the class cleavage has not been strongly supported while the class differences have been evidenced in perceived class conflicts [@perez_class_2023;@edlund_democratic_2015], attitudes on market-based inequality [@andersen_preferences_2018;@lindh_public_2015], and redistributive preferences [@curtis_how_2015;@langsaether_more_2020;@brooks_why_2010]. 

However, the study of redistributive preferences has been mainly focused on the individual and household situation. In contrast, less attention has been paid to the sociability structures embedded in class relations regarding social tie formation. In this regard, how people form their friendship and partnership ties tends to be homogeneous because of the tendency towards homophily in forming interpersonal networks [@mcpherson_birds_2001;@lazarsfeld_friendship_1954]. Hereby, we argue that the scope of class analysis in attitude formation urges to be extended to stress the role of social ties and segregation as they involve social processes, such as class identity formation, internalization of shared norms, conflict, and cooperation between classes. In this regard, recent research has argued that the degree of segregation in the composition of social ties is a window for learning about others' lifestyles, economic conditions, and worldviews [@mijs_inequality_2018;@otero_power_2023]. However, there has been no systematic dialogue regarding the role of social ties on preferences for redistribution from a social network perspective. Therefore, this research aims to contribute to the ongoing literature on class-based network segregation on attitudes toward redistribution [@lindh_missing_2021;@lee_consider_2023;@paskov_crossclass_2022].

While prior research has predominantly focused on examining the impact of social class through an individualistic lens, it is noteworthy that more attention must be devoted to understanding the role of social environments in class relations. This omission is particularly surprising given that class positions are fundamentally rooted in production relations that make them inherently relational, not only in their economic underpinnings but also in the power dynamics entwined within class conflicts [@wright_comparative_1989]. In addition, the normative basis of class relations introduces the relevance of the dimensions of solidarity and reciprocity, which have been argued to provide the moral basis for legitimacy and popular support for welfare schemes [@mau_moral_2003]. This research aims to contribute to the literature on preferences toward redistribution from a relational perspective, focusing on how the structural properties of networks can influence people's preferences toward economic redistribution. 

Our research seeks to provide answers to two key questions. Firstly, at the micro-level, what is the impact of class-based network segregation on redistributive preferences? Secondly, at the macro-level, does economic inequality have a role to play in the relationship between class-based network segregation and redistributive preferences? To achieve this, we have analyzed data from the International Social Survey Program (ISSP) 2017, which comprises a sample of over 33,000 individuals across 31 countries globally. In this regard, the ISSP has a unique opportunity to date since it includes information on interpersonal networks through the position generator, the core questions for class position allocation, and attitudes toward economic inequality and redistribution.

# Theoretical views on class, social networks, and redistributive preferences

## Class relations and social networks

As social relations within the occupational structure serve as the foundation for class analysis, widening our examination to other dimensions of social life, such as family dynamics, the development of friendships, and diverse social activities, can significantly enrich the scope of class analysis, particularly concerning its relevance in political attitudes formation. In principle, social stratification scholars have traditionally considered differentiation as observable patterns of association given by the intersection of status and group membership, which can be understood as relational networks between positions [@blau_inequality_1977]. Empirically, homophily is one of the most significant findings in network research, understood as the higher likelihood of tie formation between people of similar characteristics [@mcpherson_birds_2001, p.416] that trace friendship and family ties, such as age and gender, as well as segregated social environments alongside ethnicity and socioeconomic status [@bargsted_pautas_2020; @plaza_juntos_2022;@lazarsfeld_friendship_1954]. In addition, psychosocial factors such as socialization preferences and group dynamics also play a role in segregation processes, considering that isolated social environments decrease the interchange of worldviews, reinforcing in-group selectivity and value similarity [@visser_attitudes_2004;@homans_human_1951]. Nonetheless, without denying the relevance of socialization preferences, segregation has been predominantly explained through social differentiation in social activities as foci of contact opportunities that ultimately consolidate social networks [@feld_focused_1981; @mcpherson_network_2019]. From this perspective, we argue that class relations represent not only resource-based distinctions but also patterns of sociability and exchange observed in the differentiation of social ties.

How classes are formed also provides insight into social relations and sociability practices. In sociology, classes are understood as the basis for action given their labor market situation, which ultimately shapes their access to opportunities and resources [@weber_economy_1978]. According to the habitus theory, classes incur a series of distinctive practices pivoted in cultural capital as the basis for mutual recognition [@bourdieu_distinction_1984]. From this approach, classes seek to improve their positions through the intergenerational transmission of resources, where similarities in friendship and family choices play a crucial role in reproducing privileged social positions. Additionally, while symbolic resources reinforce status distinctions, access to exclusive social activities in the upper class increases segregation at the expense of excluding lower classes [@bourdieu_reproduccion_1981]. Ultimately, classes consolidate their demographic and cultural identities by mobilizing resources and shared sociability practices, ensuring the intergenerational reproduction of their structural positions [@goldthorpe_sobre_1992]. Hence, the socialization of common lifestyles and shared worldviews facilitates the consolidation of social classes, where access to resources embedded in social networks follows a pattern of accumulation that ultimately leads to social segregation in both the upper and lower bounds of the social structure.
 
Previous research on social class and tie formation has suggested that class permeability in social networks, understood as the formation of cross-class social ties, can be traced differently across property and authority boundaries. Empirically, evidence from Western industrialized societies has shown that the formation of friendship ties between owners and the working class is significantly less likely, in contrast to the tendency of higher tie formation between supervisors and manual workers. This suggests that the property dimension is much less permeable than authority-based boundaries, given that class interests increase the social distance between proprietors and workers, while the intermediate class position of supervisors and contact frequency with workers make friendship tie formation more likely [@wright_relative_1992]. Similarly, evidence from Chile has shown that the higher permeability of the intermediate classes contrasts with the more homogeneous networks of the working class, suggesting that their limited resources and lower capacity to be socially engaged ultimately result in a lack of social resources that lead to social isolation, whereas the upper class is less permeable and homogenous because of its tendency to self-select as a practice that ultimately seeks to reproduce their privileged status positions [@otero_open_2021]. 

By contrast, cross-class embeddedness can be described in terms of social activities, generational changes, and the life course. In this regard, @pichler_social_2009 suggest that higher civic engagement in formal organizations increases the chances of bridging with diverse people among the upper class, in contrast to the working class, which tends to be more homogeneous in civic engagement behavior. Similarly, other studies in Europe and South America have shown that the upper and intermediate classes hold increasingly diverse and prestigious social environments than the working classes, where being socially mobile helps to improve both dimensions in tie formation [@cepic_how_2020;@carrascosa_class_2023]. Nevertheless, it does not equalize the weight of the class background compared with those that are intergenerationally stable in the upper class. Additionally, the little longitudinal evidence suggests that networks change following a dynamic of cumulative advantages regarding its composition in terms of prestige and diversity, where upper classes improve in both dimensions, while the lower class shows more stability across the life course [@volker_social_2020]. 

Altogether, these studies account for class-based network segregation, as the degree of connectedness of an individual to different occupations is meant to represent social resources embedded in social networks vertically in the social structure [@lin_social_2007]. Drawing on this approach, stratification scholars have focused on how social connections are distributed across class structure as a matter of social integration [@blau_macrosociological_1977]. In addition, homogeneity is described as lacking cross-class network ties and is conceptually more proximate to the homophily principle because it is anchored in individual class positions. Simultaneously, _diversity_ is defined as the rate of dissimilar ties or simply the total ties to certain groups that do not necessarily count with a reference position to describe the network composition. Hence, both approaches provide alternatives for studying social class from a network perspective, which has been increasingly discussed in the stratification literature and scholarly discussion about social class and political attitudes. 

## Network segregation and attitudes toward redistribution 

Besides from the individual approach to attitude formation, we argue that people also form opinions in the economic domain based on their social relations. Despite limited research on the link between social ties and attitudes in the economic domain, we identify two broad theoretical approaches that have discussed the role of the social environment in attitude formation.

On the one hand, one approach accentuates the role of beliefs about economic inequality rooted in social comparison processes as an explanation through which people form opinions about redistributive policies [@condon_economic_2020]. This hypothesis can be traced to the studies on class images and perceived class conflicts [@Evans1992;@kelley_class_1995]. Here, the initial argument is that people form their beliefs through the individual, family, friends, and coworkers’ experiences instead of the whole society, which is described as an availability heuristic that systematically biases inferences about inequality based on the homophily of reference groups [@Evans1992, p. 467]. From this perspective, how people infer the social world is linked to the degree of segregation in their immediate social environment, which influences the intensity and character of the information that ultimately shapes their perceptions of inequality [@mijs_is_2021]. Thus, experience sharing in conversations with socioeconomically diverse networks has been proven to contribute to the accuracy of the images of income and wealth inequalities compared with people in more isolated discussion networks [@summers_deliberating_2022]. Despite this, we argue that this research field has been more focused on the cognitive dimension of preference formation through inequality perceptions, either relying on surveys [e.g. @cansunar_who_2021;@garcia-castro_perceived_2022] or experimental manipulations [e.g. @Cruces2011;@becker_significant_2021] rather than empirically addressing the role of class segregation in social networks and its claimed influence on attitudes in the economic domain.

In contrast, it has been suggested that the lens of a network approach provides a better picture of class relations that nurture social norms and group identity [@kalmijn_social_2007, p. 550]. This claim resembles the fact that classes are characterized as collectivities with differences in their degrees of cohesion and solidarity, encompassing unequal status-based social interactions that are linked to individual or household material well-being, cultural perspectives, and political preferences that structure broader social experiences [@morris_attenuation_1996, p. 48]. Furthermore, social integration can be affected in societies with lower contact opportunities between different social classes, where social distance among them widened by extreme inequality can create an “empathy gulf” that comprises barriers to imagining others’ lifestyles [@sachweh_moral_2012]. In this matter, spatially segregated interactions may nurture doubts about worthiness when the lower classes contrast themselves with the lifestyles of the upper classes, which might undermine feelings of social inclusion and cohesion [@sachweh_moral_2012]. Consequently, segregation drives the lives of others to become more distant and might have consequences for empathy and solidarity toward others, potentially leading to the perception of fellow citizens as strangers [@otero_lives_2022, p. 758]. Thus, we suggest that attitudes towards redistribution may be influenced by the class situation of both the individual and network ties, where social influence processes can either align or polarize attitudes according to the characteristics of groups and the level of segregation that allows factual contact opportunities. 

In recent years, we have seen an increase in this network turn of class analysis, contributing to unraveling the relationship between the composition of social ties and attitudes toward inequality. In this regard, it has been shown that the degree of contact between different classes has shown that individuals of the lower class interacting with those of the upper classes may consider economic inequality as justifiable, whereas interactions with those of the lower class may prompt individuals from different social classes to question the fairness of income distribution [@vargassalfate_contact_2023]. Further evidence suggests that class-based contact diversity shortens the social distance between social classes, providing broader images of the living conditions of others, which can trigger greater concerns about inequality [@otero_power_2023] and undermine support for the market distribution of social services [@beck_explorando_2019]. 

In addition, studies that directly addressed the relationship between networks and social classes have been consistent with previous findings. For instance, evidence from Sweden suggests that people tend to assimilate their opinions according to their surrounding friends and acquaintances, which is reinforced by class homophily, where higher contacts in the managerial class negatively influence support for redistribution, while ties to the working class increase it regardless of the individual class position suggesting that “individuals take an impression from others and modify their attitudes accordingly” [@lindh_missing_2021, p. 698]. Similarly, additional socialization sources are cross-class ties through family members. In this sense, the family of origin is crucial for political socialization, where class interests and norms are nurtured in childhood and early adulthood. A study in the United States showed that those tied to the upper class through parental relations support redistribution and progressive taxation less than those with working-class family backgrounds [@lee_consider_2023]. In addition, @paskov_crossclass_2022 argues that the class position of family and partners shapes preferences, while households share risk according to the class position of their members, where class homogeneity in ties polarizes preferences between lower and upper classes. In contrast, this gradient is blurred as heterogeneity increases according to the class position of the partner and family of origin.

In summary, we argue that class-embedded social relations play a substantial role in shaping support for redistribution. In this sense, the tendency to form homophilous social ties in terms of social class reinforces attitudes and consolidates opinion similarity. Thus, we hypothesize that segregation in similar class environments polarizes individual class interests so that segregated lower (upper) classes hold more (less) redistributive preferences (H1).

##  Consequences of Economic Inequality on Social Networks and Redistributive Preferences

### Consequences of Economic Inequality on Social Networks 

The consequences of inequality in social relationships are diverse. Theoretically, it has been stated that economic inequality deepens material and symbolic differences between members of a society, where those in the most favored positions generally become more distant from those with access to fewer resources. Consequently, lower resources can constrain or discourage people from actively participating in social life, ultimately affecting the chances of meeting others with different economic conditions and lifestyles [@neckerman_inequality_2007, p. 344]. In this discussion, one approach has stressed the role of subjective experiences of inequality in social relations, arguing that a broader gap in economic resources has consequences on perceived competition and status anxiety [@wilkinson_spirit_2010;@garcia-sanchez_perceived_2024]. Therefore, driving stronger experiences of relative deprivation undermines trust in others, given the difficulties of setting shared goals and perceiving others as part of a collectivity that pursues the common good [@salgado_expectations_2021]. In contrast, the neo-materialist approach sets the attention on resource availability and attributes much less importance to subjective experiences, arguing that more economically equal societies are also characterized by extended welfare institutions that seek to diminish the consequences of unequal access to resources that provide better conditions for people to be socially engaged by improving social trust and individual well-being [@lynch_income_2004;@uslaner_inequality_2005;@kragten_income_2017]. In sum, living in more unequal societies goes hand in hand with more extraordinary experiences of uncertainty, which at the same time may be hindered by a lack of trust in the broader social context, affecting the motives to participate in social activities that play a fundamental role in establishing ties between dissimilar groups, either by status or social class [@lancee_diversity_2017].

Empirically, the few studies on this subject share the assumption that economic inequality translates into social distance in terms of class and status positions, which is the basis for consolidating network segregation. Cross-national comparisons in Europe show that the patterns of participation and association in formal organizations, as well as those of informal networks in providing social support, are manifested in the form of complementarity or substitution according to the cultural relevance of family or friendship networks and the character of the welfare regime [@pichler_patterns_2007]. By contrast, @pichler_social_2009 accounts for the role of income inequality on participation in formal and informal networks, showing that more unequal societies depress the extensiveness of formal participation but not the frequency. In addition, it is one of the few studies that show how, in more unequal societies, class differences in participation are deepened in the diversity of formal participation networks. Similarly, @lancee_income_2012 shows that economic inequality reduces participation. However, in formal networks, the inhibiting effect of inequality is better evidenced, being less relevant to participation in informal networks. In addition, they show that in more unequal societies, the stratification of participation by income level is strengthened, favoring those with greater resources and marginalizing the poorest.

In contrast to studies on participation in formal and informal networks, recent research has emphasized economic inequality in the structure of interpersonal networks. For instance, @letki_getting_2015 argued that economic inequality may constrain access to more extensive networks and the chances of receiving support through them. First, they found that individuals in lower-income groups have smaller networks than those in wealthier groups and are less likely to access resources through them. However, as inequality increases, low-income individuals hold much more extensive family networks but are less inclined towards utilizing their social ties to access resources than middle- and higher-income groups. They suggest that "the poor see maintaining ties with a large extended family as crucial for accessing needed help, which they are unlikely to reach through non-kinship ties" [@letki_getting_2015, p. 244]. By contrast, @otero_differences_2023 found that income inequality is not directly associated with the network structure. However, they found that income inequality can enhance the relationship between educational level, occupational status, and the diversity of social ties. They suggest that income inequality can exacerbate social stratification, creating greater interdependence between cultural, economic, and social capital. Hence, they argue that the unique positions held by the upper classes enable them to navigate different social settings while remaining segregated, whereas the lower classes may experience greater marginalization and isolation because of the choices of others [@otero_open_2021, p.24]. In this regard, if we assume that economic inequality sets the conditions for sociability, a possible consequence may be that the degree of segregation in interpersonal networks and its influence on popular views about economic inequality is also affected by the extent of income differences.

### Consequences of Economic Inequality on Redistributive Preferences

As mentioned, economic inequality influences social relations overall or strengthens inequalities throughout the social structure. However, studies on redistributive preferences have provided mixed evidence of the direct impact of income inequality on support for redistribution [@evans_strong_2018;@trump_income_2023]. In turn, an open discussion has been raised regarding why those in the upper social strata are more sensitive to changes in economic inequality than those in the lower strata. 

Theoretically, two approaches were considered in this discussion. On the one hand, some studies have suggested that high-income individuals are far from monolithic in their redistributive preferences, arguing that, although the rational interest model maintains its general implications, there are nuances within the upper-income strata regarding their greater concerns about the negative externalities of economic inequality (e.g., crime), which ultimately motivate altruistic support for redistribution  [@rueda_food_2018;@dimick_models_2018;@dimick_altruistic_2017;@rueda_externalities_2016]. Additionally, another body of literature has suggested that the differences among the affluent can be understood from a distributive justice framework that focuses on the justice evaluation under which economic resources are allocated [@liebig_sociology_2016]. The central argument suggests that affluent groups are more sensitive to economic inequality changes as they perceive that the overall opportunity structure is affected. In contrast, low-income individuals tend to perceive that the ascribed characteristics are stronger in constraining the opportunity structure, regardless of current income inequality [@sachweh_why_2019, p. 656]. Likewise, it has been argued that perceived inequality of opportunity can motivate support for redistribution as a matter of justice in the conditions for getting ahead, showing that this is particularly present in individuals in higher socioeconomic positions [@kim_socioeconomic_2018]. Therefore, if the degree of segregation in social networks is related to polarization in redistributive attitudes, we believe that income inequality might also play a role in the relationship between class relations and redistributive attitudes.

Empirically, while an important part of the studies addressing the role of economic inequality and redistribution preferences has focused on income, it is also possible to find efforts that emphasize the role of social class. In the first case, comparative studies in various societies have demonstrated (1) the relevance of income position and (2) the sensitivity of high-income groups to material inequality [@Schmidt-Catran2016; @franetovic_preferences_2022; @finseraas_income_2009]. However, class-based studies have contributed equally to the elucidation of this relationship. For example, @edlund_democratic_2015 established that the demand for state-organized redistribution reflects the level of political class conflict in a modern industrialized society. Thus, their argument suggests that inequality plays a key role in moderating these conflicts because there is evidence of greater political consensus supporting redistribution in societies with greater material inequality. They emphasize that social classes should not be undervalued as vehicles of antagonism and social tension [@edlund_democratic_2015, p. 323].

Similarly, @curtis_how_2015 suggest two possible implications for the class cleavage in redistributive preferences in contexts of rising economic inequality. One argument suggests that the decline in social cohesion expressed in trust, civic participation, and prosocial attitudes might undermine the normative basis for collective solidarity [@uslaner_inequality_2005]. As a result, less cohesive societies can nurture stronger class polarization that undermines egalitarian attitudes [@andersen_preferences_2018], making the middle classes less prone to support policies favoring the working classes. In contrast, the other argument posits that in the context of greater economic inequality, the middle classes tend to have greater political awareness about the causes and incentives of economic inequality [@Svallfors2006, pp. 66–67], as well as its consequences for class conflict and cohesion [@kelley_class_1995]. Additionally, it has been suggested that the degree of perceived social conflict decreases in societies with lower material inequality and a predominant middle-class imaginery [@hertel_conflict_2022]. Therefore, in more unequal societies, those who are better-off are more likely to support redistribution than their counterparts in more egalitarian contexts, where their attitudes gradually converge with the interests of the working class.

To summarize, the current state of research has led us to establish two competing scenarios based on the reviewed evidence and theoretical assumptions regarding the role of economic inequality in the relationship between class-based segregation and redistributive preferences. On the one hand, if we assume that social relations are eroded in more unequal societies, social classes might be more distant due to lower social trust and participation in formal and informal networks. Therefore, one possible expectation is that in unequal societies, the influence of class segregation on redistribution preferences will be stronger (H2a). In contrast, if we assume that economic inequality has unequal consequences for those in the bottom and top rungs of the class structure in terms of cross-class embeddedness. In that case, it might be possible that the working classes are equally segregated regardless of income inequality compared to the more diverse contact and activity networks of the upper classes. Likewise, in line with evidence that suggests that the upper classes tend to be more concerned about the causes and consequences of economic inequality, our alternative expectation is that inequality will mitigate the role of network segregation on redistribution preferences, particularly among the upper classes (H2b).

# Data, variables and method

## Data {-}

## Variables {-}

### _Individual level_ {-}

**Redistributive preferences**: Two indicators available in the questionnaire were used to measure redistributive preferences.  First, support for government redistribution (1) is measured by the item 'It is the responsibility of the government to reduce the differences in income between people with high incomes and those with low incomes.' and the egalitarian preferences represented by the item (2) 'For a society to be fair, differences in people's standard of living should be small.' indicators are five-point Likert scales with the categories 'Strongly agree' (1), 'Agree' (2), 'Neither agree nor disagree' (3), 'Disagree' (4) and 'Strongly disagree' (5). Thus, based on previous research and the high degree of correlation between the indicators (_r_ = 0.7), we proceed to reverse-code and create a standardized average index ranging from 1 to 100, where higher values represent greater redistributive preferences [@svallfors_government_2013].

[likertplot] 

**Social class**:  The Erikson-Goldthorpe-Portocarrero (EGP) Class Scheme is employed [@Erikson1992;@Erikson1979], one of the most consistent and validated measure for social class positions in comparative research [@evans_political_2013] and has demonstrated its validity in regions of the industrialized world, as well as in countries of late industrialization [@solis_class_2019;@torche_unequal_2005;@ishida_trends_2005;@barozet_measurement_2021; @wang_where_2024]. Thus, based on the recently developed DIGCLASS algorithm, we draw on the available information regarding (i) occupations, (ii) self-employment status and (iii) the number of workers [@cimentada_digclass_2023]. As a result, following previous research on political attitudes, a collapsed version of three big classes is employed, including the Service Class (I+II),  Intermediate Class (III+IV), and Working Class (V+VI+VII) [@sosnaud_class_2013;@edlund_influence_2003]. 

**Class-based network segregation**: To create our measure of network homogeneity based on social class, we employed the position generator available in the questionnaire. This instrument has been widely employed in social capital studies, relying on the assumption that access to social resources is based on ties to different positions in the social structure following an ego-centered network approach [@lin_access_1986;@vandergaag_position_2008]. In this case, the position generator shows a list of ten occupations where the respondent declares four possible options through which this tie is classified: "Family or relative", "Close friend", "Someone else I know", and "No one". In the case of the indicator used here, the first three categories are classified as "Knows" = 1 and "Does not know" = 0. On the basis of this, it is possible to obtain the total number of a person's social ties. Subsequently, the occupations were classified into three groups resembling social class positions [@otero_open_2021]. First, the Lawyer, Executive of a large firm, and Human resource manager are classified as high status. Then, a School teacher, Police officer, and Nurse are considered as Intermediate status. Finally, a car mechanic, bus driver, hairdresser, and home or office cleaner are considered as low-status occupations.

After this, we calculated the number of social ties for each status group. Consequently, the group closer to their class position obtains a proxy of the number of ingroup social ties. Finally, the number of ingroup ties is divided by the total number of contacts to provide a measure of network homogeneity that seeks to represent the share of similar social ties within the personal network [@otero_lives_2022; @volker_birds_2022]. Here, zero represents that all social ties are *different* (heterogeneity), while one means that all social contacts are similar (homogeneity). In substantial terms, higher values represent greater social distance from other social classes in society.

As recently suggested, we have selected a set of control variables following substantive reasoning based on the current state of social network and redistributive preferences research [@kohler_control_2024]. Studies on social capital, network size, and social trust have been included in the estimations. The number of social ties or volume in a network can also have implications for instrumental and expressive outcomes such as job prospects or evaluations of self-worth [@contreras_inequality_2019;@kim_social_2021]. Likewise, social trust has been pointed out as a condition in forming social ties beyond the ingroup, as it means that people can rely on others and engage in supportive networks that may even play a substitute role in welfare provision [@jaime-castillo_social_2016]. In addition, redistributive preferences can be explained through economic self-interest, with higher-income individuals typically opposing redistribution while recognizing that the reduction of inequality would be at their expense by increasing the tax burden [@meltzer_rational_1981]. In addition, it has been argued that education provides greater security to cope with the dynamics of the labor market, which results in higher skills being linked to less support for redistribution [@kitschelt_occupations_2014]. Likewise, job status represents labor market integration, where outsiders are more supportive of redistributive policies due to their willingness to cope with labor market vulnerability [@hausermann_highskilled_2015]. Finally, it has been argued that besides the self-interest of the unionized working class members, unions also play a role as political socialization agents that seek to nurture egalitarian values and altruistic motives rooted in class solidarity [@han_labor_2022].

Regarding sociodemographic characteristics, prosocial attitudes can be attributed to socialization and cultural norms, with women generally exhibiting a greater capacity for empathy that motivates them to engage in more communal and relational behavior than men [@eagly_his_2009]. In addition, women tend to be placed in interpersonal service occupations with lower wages and higher market risk than their male counterparts [@waitkus_investigating_2021]. Substantial differences have also been demonstrated according to the age of individuals, as life cycle stages constitute different degrees of dependence and exposure to risk, and different age cohorts encapsulate different experiences of economic and political shocks. [@vanheuvelen_intercohort_2018]. Concerning religion, evidence has shown that religious individuals support redistribution to a greater extent, as religious communities incentivize uninterested altruistic behavior and prosocial values. However, it has also been suggested that religious behavior can decrease support for redistribution as it contributes to individual well-being [@arikan_was_2019]. Thus, it has been shown that people who do not have a partner tend to be more supportive of redistribution, suggesting that marital ties constitute a support network through which it is possible to mobilize resources and social support [@alesina_preferences_2005].

### _Macro level_ {-}

* Income Inequality (post-taxes): Gini Index from the World Income Inequality Dataset (https://wid.world/)

* Gross Domestic Product per capita (WID, 2022)

* Size of the welfare state [see @edlund_democratic_2015]
  - Current Redistribution (Solt, 2020)
  - Tax revenue, as percentage of GDP (ILO)
  - Welfare expenditure, as percentage of GDP (ILO)
  
## Method {-}

Multilevel regression models with random and fixed effects. For the cross-level interactions, we include random slopes, and all variables are group-mean centered (CWC)

# Results

## Descriptive

```{r fig1, fig.dim=c(12,5),fig.cap='Bivariate relationships between Income Inequality, Social Class and Network homogeneity',warning=FALSE}
set1 <-  RColorBrewer::brewer.pal(n = 8, name = "Set1")
options(ggplot2.discrete.fill = set1)
options(ggplot2.discrete.colour = set1)
ggplot2::theme_set(ggplot2::theme_bw())
ggplot2::theme_update(text=ggplot2::element_text(size=15,  family="serif"))
options(scipen=999)
if (!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr,sjmisc,ggplot2,interplot,marginaleffects,sjlabelled,haven,stringr,ordinal,texreg,MLMusingR,lme4)  
rm(list=ls())

load(here::here("input/data/proc/study1_country.RData"));df1 <- df2

df1$dclass3spo_V <- car::recode(df1$dclass3spo_V,"NA='No information (Missing, No partner)'",levels = c("Service Class (I+II)","Intermediate class (III+IV)","Working Class (V+VI+VII)","No information (Missing, No partner)"))

dfreg <- df1 %>% dplyr::select(
  egal = egal2,
  # starts_with("class3"),
  # starts_with("digclass3"),
  # starts_with("dclass3"),
  # starts_with("homclass"),
  dclass3res_V,
  dclass3spo_V,
  homclass3_V_res,
  know_total,
  socialtrust,
  Q03pcm,
  edyears,
  female,
  agenum,
  religion,
  partner,
  union,
  workst,
  WEIGHT,
  region,
  "gini_disp"=wid_gini_disp,
  "gini_mkt",
  gv_spen,
  rel_red,
  abs_red,
  ilo_taxrev,
  ilo_govspe,
  d10d1=wid_p90p10,
  wid_p90p50,
  top10=wid_sharetop10,
  rgdpna,
  gdppercapita,
  oecd,
  country2, country, country3,
) %>%
  # filter(oecd == "OECD") %>%
  filter(country2 != "SVN") %>% 
  na.omit() %>% 
    mutate(loggdppercapita=scale(gdppercapita/1000),
         edyears2 = edyears ^ 2,
         age2 = agenum ^ 2, 
         # gini_disp=scale(gini_disp),
         )

homo_ineq <- dfreg %>%
  # filter(country3 != "ZAF") %>%
  group_by(country2,country3,dclass3res_V) %>%
  summarise_at(c("homclass3_V_res","egal","gini_disp"), mean, na.rm = TRUE) %>% 
  as.data.frame()

homo_ineq$country <- countrycode::countrycode(sourcevar = homo_ineq$country2,origin = "iso3c",destination = "iso2c")

homo_ineq$dclass3res_V <- forcats::fct_rev(homo_ineq$dclass3res_V)
homo_ineq %>%
ggplot(aes(y=homclass3_V_res, x=gini_disp, group=dclass3res_V,fill=dclass3res_V)) +
  geom_text(label=as.character(homo_ineq$country),size=3) +
  geom_smooth(method = "lm",fullrange=TRUE, color="black",linetype = 2,size=1,se = FALSE) +
  facet_wrap(~dclass3res_V) +
  xlab("Income Inequality")+
  ylab("Network homogeneity") +
  # labs(title = "Class homogeneity and Gini (post-taxes)") +
  scale_fill_manual(values=c("#CCCCCC","#989898","#323232"))+
  scale_color_manual(values=c("#CCCCCC","#989898","#323232")) +
  theme(legend.position = "none",legend.title = element_blank())

```

## Multivariate results

```{r table1, results='asis'}
set1 <-  RColorBrewer::brewer.pal(n = 8, name = "Set1")
options(ggplot2.discrete.fill = set1)
options(ggplot2.discrete.colour = set1)
ggplot2::theme_set(ggplot2::theme_bw())
ggplot2::theme_update(text=ggplot2::element_text(size=15,  family="serif"))

if (!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr,sjmisc,ggplot2,interplot,marginaleffects,sjlabelled,haven,stringr,ordinal,texreg,MLMusingR,lme4)  
rm(list=ls())

load(here::here("input/data/proc/study1_country.RData"));df1 <- df2
dfreg <- df1 %>% dplyr::select(
  egal = egal2,
  dclass3res_V,
  dclass3spo_V,
  homclass3_V_res,
  know_total,
  socialtrust,
  Q03pcm,
  edyears,
  female,
  agenum,
  partner,
  religion,
  union,
  workst,
  WEIGHT,
  region,
  "gini_disp"=wid_gini_disp,
  "gini_mkt",
  gv_spen,
  rel_red,
  d10d1=wid_p90p10,
  wid_p90p50,
  top10=wid_sharetop10,
  rgdpna,
  gdppercapita,
  oecd,
  country2, country, country3,
) %>%
  mutate(logrgdpna = log(rgdpna),
         loggdppercapita=log(gdppercapita),
         edyears2 = edyears ^ 2,
         age2 = agenum ^ 2) %>%
  # filter(oecd == "OECD") %>%
  filter(country2 != "SVN") 

dfreg$dclass3spo_V <- car::recode(dfreg$dclass3spo_V,"NA='No information (Missing, No partner)'",levels = c("Service Class (I+II)","Intermediate class (III+IV)","Working Class (V+VI+VII)","No information (Missing, No partner)"))
df1$dclass3spo_V <- car::recode(df1$dclass3spo_V,"NA='No information (Missing, No partner)'",levels = c("Service Class (I+II)","Intermediate class (III+IV)","Working Class (V+VI+VII)","No information (Missing, No partner)"))

# sjPlot::tab_xtab(df1$dclass3spo_V,df1$PARTLIV)

dfreg <- na.omit(dfreg)

## Model -  EGP3 - DIGCLASS - V to Working -----------------------------
digclas1_VW_1<- lmer(egal~1 + homclass3_V_res + female+agenum+age2 + partner + religion + (1|country2),data=dfreg,weights = WEIGHT)
digclas1_VW_2<- update(digclas1_VW_1, . ~ . +know_total+socialtrust)
digclas1_VW_3 <- update(digclas1_VW_2, . ~ . + dclass3res_V)

digclas1_VW_4 <- update(digclas1_VW_3, . ~ . + dclass3res_V+female+agenum+age2)
digclas1_VW_5 <- update(digclas1_VW_3, . ~ . + dclass3res_V+female+agenum+age2+edyears+ Q03pcm+workst+union)
digclas1_VW_6 <- update(digclas1_VW_3, . ~ . + dclass3res_V+female+agenum+age2+edyears+ Q03pcm+workst+union+dclass3spo_V)
digclas1_VW_7 <- update(digclas1_VW_6, . ~ . +dclass3res_V*homclass3_V_res)
digclas1_VW <- list(digclas1_VW_1,digclas1_VW_2,
                    digclas1_VW_3,
                    # digclas1_VW_4,
                    digclas1_VW_5,digclas1_VW_6,digclas1_VW_7)

ccoef <- list(homclass3_V_res="Class-based network homogeneity",
              know_total="Network size",
              socialtrust="Social Trust",
              "dclass3res_VIntermediate class (III+IV)"="Intermediate Class",
              "dclass3res_VWorking Class (V+VI+VII)"="Working Class",
              # "femaleFemale"="Female (Ref. = Male)",
              # "agenum"="Age",
              # "age2"="Age2",
              "edyears"="Year of Education",
              "Q03pcmT02"="Income (T2)","Q03pcmT03"="Income (T3)","Q03pcmMissing"="Income (No information)",
              "workstNot in paid work" = "Not in paid work (Ref. = In paid work)",
              "unionYes" ="Union Membership (Ref. = Not Unionized)",
              "dclass3spo_VIntermediate class (III+IV)" = "Intermediate Class (Partner)",
              "dclass3spo_VWorking Class (V+VI+VII)" = "Working Class (Partner)",              
              "dclass3spo_VNo information (Missing, No partner)" = "No information (Not available, No partner)",
              "homclass3_V_res:dclass3res_VIntermediate class (III+IV)" = "Homogeneity*Intermediate Class",
              "homclass3_V_res:dclass3res_VWorking Class (V+VI+VII)" = "Homogeneity*Working Class")

texreg(digclas1_VW,stars = c(0.001, 0.01, 0.05, 0.1),
       caption = "Multilevel models for Class-based network segregation and Redistributive Preferences",
       custom.note = "%stars. Models include sampling weights. Gender, age, marital status and religion are included as controls",
       caption.above = T,leading.zero = T,
       custom.coef.map = ccoef,
       symbol = "+",scalebox = 0.60,
      groups = list("Social Class (Ref.= Service Class)" = 4:5, "Household Income (Ref.= Tertile I)"= 7:9,  "Partner's Social Class (Ref.= Service Class)" = 12:14, "Homogeneity x Social Class"=15:16),
      custom.gof.rows = list("Controls"=rep("Yes",6)),include.loglik = FALSE,include.aic = FALSE,
      custom.gof.names = c(NA,NA,"Num. groups","Var: Country (Intercept)","Var: Residual"),
       float.pos = "h!",
       use.packages = F)
```

\newpage 

```{r fig3, fig.dim=c(10,5),fig.cap='Linear Predictions for Network Homogeneity on Redistributive Preferences by Social Class',warning=FALSE}
int_homo <- digclas1_VW_7
df_pred1 <- 
  predictions(int_homo, condition = c("homclass3_V_res","dclass3res_V"),
              newdata = datagrid(homclass3_V_res = seq(min(dfreg$homclass3_V_res), max(dfreg$homclass3_V_res), by= 0.1),
                                 dclass3res_V = levels(dfreg$dclass3res_V)))
# names(df_pred1)
df_pred1 %>% 
ggplot(aes(y =estimate,x=homclass3_V_res, fill=dclass3res_V, color=dclass3res_V,ymin=conf.low, ymax=conf.high)) +
  geom_ribbon(alpha=0.8,size=1,linetype="solid",color="black") +
  geom_line(size=1,color="black") +
  geom_point(size=2,color="black") +
  facet_grid(~factor(dclass3res_V, levels=
                       c("Working Class (V+VI+VII)","Intermediate class (III+IV)","Service Class (I+II)"),
                     c("Working Class (V+VI+VII)","Intermediate class (III+IV)","Service Class (I+II)"))) +
  scale_fill_manual(values=c("#323232","#989898","#CCCCCC"))+
  scale_color_manual(values=c("#323232","#989898","#CCCCCC"))+
  scale_y_continuous(limits = c(50,80))+
  labs(caption = paste0("N=",nobs(int_homo),", Countries=",lme4::ngrps(int_homo)),
       x="Network homogeneity",y="Redistributive preferences") +
  theme(legend.position = "none", legend.title = element_blank())
```

\newpage

```{r tab2, results='asis', cache=TRUE}
set1 <-  RColorBrewer::brewer.pal(n = 8, name = "Set1")
options(ggplot2.discrete.fill = set1)
options(ggplot2.discrete.colour = set1)
ggplot2::theme_set(ggplot2::theme_bw())
ggplot2::theme_update(text=ggplot2::element_text(size=15,  family="serif"))
options(scipen=999)
if (!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr,sjmisc,ggplot2,interplot,marginaleffects,sjlabelled,haven,stringr,ordinal,texreg,MLMusingR,lme4)  
rm(list=ls())

load(here::here("input/data/proc/study1_country.RData"));df1 <- df2

df1$dclass3spo_V <- car::recode(df1$dclass3spo_V,"NA='No information (Missing, No partner)'",levels = c("Service Class (I+II)","Intermediate class (III+IV)","Working Class (V+VI+VII)","No information (Missing, No partner)"))

dfreg <- df1 %>% dplyr::select(
  egal = egal2,
  # starts_with("class3"),
  # starts_with("digclass3"),
  # starts_with("dclass3"),
  # starts_with("homclass"),
  dclass3res_V,
  dclass3spo_V,
  homclass3_V_res,
  know_total,
  socialtrust,
  Q03pcm,
  edyears,
  female,
  agenum,
  religion,
  partner,
  union,
  workst,
  WEIGHT,
  region,
  "gini_disp"=wid_gini_disp,
  "gini_mkt",
  gv_spen,
  rel_red,
  abs_red,
  ilo_taxrev,
  ilo_govspe,
  d10d1=wid_p90p10,
  wid_p90p50,
  top10=wid_sharetop10,
  rgdpna,
  gdppercapita,
  oecd,
  country2, country, country3,
) %>%
  # filter(oecd == "OECD") %>%
  filter(country2 != "SVN") %>% 
  na.omit() %>% 
    mutate(loggdppercapita=scale(gdppercapita/1000),
         edyears2 = edyears ^ 2,
         age2 = agenum ^ 2, 
         gini_disp=scale(gini_disp))

dfreg$wstate2 <- scale(scale(dfreg$abs_red*100) + scale(dfreg$ilo_taxrev) + scale(dfreg$ilo_govspe))

# Variable Group-Centering ------------------------------------------------
dfreg <- 
  dfreg %>% 
  mutate(to_dummy(female),
         to_dummy(union),
         to_dummy(workst),
         # dummy for categorical variables-------------------------------------
         to_dummy(Q03pcm),
         to_dummy(dclass3spo_V)
  )
dfreg$female_gc = group_center(dfreg$female_2, grp = dfreg$country2)
dfreg$union_gc = group_center(dfreg$union_2, grp = dfreg$country2)
dfreg$workst_gc = group_center(dfreg$workst_2, grp = dfreg$country2)
dfreg$edyears_gc = group_center(dfreg$edyears, grp = dfreg$country2)
dfreg$agenum_gc = group_center(dfreg$agenum, grp = dfreg$country2)
dfreg$age2_gc = group_center(dfreg$age2, grp = dfreg$country2)
dfreg$socialtrust_gc = group_center(dfreg$socialtrust, grp = dfreg$country2)
dfreg$homclass3_V_gc <-group_center(dfreg$homclass3_V_res, grp = dfreg$country2)
dfreg$know_total_gc = group_center(dfreg$know_total, grp = dfreg$country2)
dfreg$religion_gc = group_center(as.numeric(dfreg$religion), grp = dfreg$country2)
dfreg$partner_gc = group_center(as.numeric(dfreg$partner), grp = dfreg$country2)


# Household Income Tercile
dfreg$Q03pcm_1_gc = group_center(dfreg$Q03pcm_1, grp = dfreg$country2)
dfreg$Q03pcm_2_gc = group_center(dfreg$Q03pcm_2, grp = dfreg$country2)
dfreg$Q03pcm_3_gc = group_center(dfreg$Q03pcm_3, grp = dfreg$country2)
dfreg$Q03pcm_NA_gc = group_center(dfreg$Q03pcm_4, grp = dfreg$country2)

# Partner Social Class
dfreg$dclass3spo_V_1_gc = group_center(dfreg$dclass3spo_V_1, grp = dfreg$country2)
dfreg$dclass3spo_V_2_gc = group_center(dfreg$dclass3spo_V_2, grp = dfreg$country2)
dfreg$dclass3spo_V_3_gc = group_center(dfreg$dclass3spo_V_3, grp = dfreg$country2)
dfreg$dclass3spo_V_NA_gc = group_center(dfreg$dclass3spo_V_4, grp = dfreg$country2)

# drop dummies
dfreg <- dplyr::select(dfreg,-c(female_1,female_2,union_1,union_2,workst_1,
                                workst_2,Q03pcm_1,Q03pcm_2,Q03pcm_2,Q03pcm_4,
                                dclass3spo_V_1,dclass3spo_V_2,dclass3spo_V_3,dclass3spo_V_4))

# dfreg$gini_disp <- scale(dfreg$gini_disp)

## Model -  EGP3 - DIGCLASS - V to Working -----------------------------
homo_V_gini <- 
  lmer(egal~ 
         homclass3_V_gc+
         know_total_gc+
         socialtrust_gc+
         dclass3res_V+dclass3spo_V_2_gc+dclass3spo_V_3_gc+dclass3spo_V_NA_gc+
         female_gc+agenum_gc+age2_gc+partner_gc+
         edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
         union_gc+workst_gc+
         gini_disp +
         (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)

homo_V_gini_gdp <- 
  lmer(egal~ 
         homclass3_V_gc+
         know_total_gc+
         socialtrust_gc+
         dclass3res_V+dclass3spo_V_2_gc+dclass3spo_V_3_gc+dclass3spo_V_NA_gc+
         female_gc+agenum_gc+age2_gc+partner_gc+religion_gc+
         edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
         union_gc+workst_gc+
         gini_disp +loggdppercapita +
         (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)

homo_V_gini_gdp_wstate2 <- 
  lmer(egal~ 
         homclass3_V_gc+
         know_total_gc+
         socialtrust_gc+
         dclass3res_V+dclass3spo_V_2_gc+dclass3spo_V_3_gc+dclass3spo_V_NA_gc+
         female_gc+agenum_gc+age2_gc+partner_gc+religion_gc+
         edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
         union_gc+workst_gc+
         gini_disp +loggdppercapita + wstate2+
         (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)

homo_V_gini_gdp_controls <-
  lmer(egal~
         homclass3_V_gc+
         know_total_gc+
         socialtrust_gc+
         dclass3res_V+dclass3spo_V_2_gc+dclass3spo_V_3_gc+dclass3spo_V_NA_gc+
         female_gc+agenum_gc+age2_gc+partner_gc+religion_gc+
         edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
         union_gc+workst_gc+
         gini_disp +loggdppercapita + wstate2 +
         (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)

homo_V_gini_full2 <- 
  lmer(egal~ 
         homclass3_V_gc+
         know_total_gc+
         socialtrust_gc+
         dclass3res_V+dclass3spo_V_2_gc+dclass3spo_V_3_gc+dclass3spo_V_NA_gc+
         female_gc+agenum_gc+age2_gc+partner_gc+religion_gc+
         edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
         union_gc+workst_gc+
         gini_disp +loggdppercapita + wstate2+
         homclass3_V_gc*
         dclass3res_V*
         gini_disp + 
         (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)

digclas1_macro <- list(homo_V_gini,
                       homo_V_gini_gdp,
                       homo_V_gini_gdp_wstate2,
                       homo_V_gini_full2)

ccoef <- list(homclass3_V_gc="Class-based network homogeneity (CWC)",
              "dclass3res_VIntermediate class (III+IV)"="Intermediate Class",
              "dclass3res_VWorking Class (V+VI+VII)"="Working Class",
              "gini_disp" = "Income inequality (Gini index)",
              loggdppercapita = "GDP/capita",
              wstate2="Size of the welfare state",
              "homclass3_V_gc:dclass3res_VIntermediate class (III+IV)" = "Homogeneity*Intermediate Class",
              "homclass3_V_gc:dclass3res_VWorking Class (V+VI+VII)" = "Homogeneity*Working Class",
              "homclass3_V_gc:gini_disp"= "Homogeneity*Income Inequality",
              "homclass3_V_gc:dclass3res_VIntermediate class (III+IV):gini_disp" = "Homogeneity*Intermediate Class*Income Inequality",
              "homclass3_V_gc:dclass3res_VWorking Class (V+VI+VII):gini_disp" = "Homogeneity*Working Class *Income Inequality")

texreg(digclas1_macro,stars = c(0.001, 0.01, 0.05, 0.1),symbol = "+",scalebox = 0.60,
       caption = "Multilevel models for Income Inequality, Network segregation and Redistributive Preferences",
       custom.note = "%stars. Models include sampling weights and individual level controls centered within cluster (group mean)",
       caption.above = T,leading.zero = T,single.row = T,
       custom.coef.map = ccoef,
      groups = list("Social Class (Ref.= Service Class)" = 2:3,"Macro-level factors"=4:6, "Homogeneity*Social Class"=7:8, "Homogeneity * Social Class * Income Inequality"=10:11),
       float.pos = "h!",
      custom.gof.rows = list("Controls"=rep("Yes",4)),include.loglik = FALSE,include.aic = FALSE,
      custom.gof.names = c(NA,NA,"Num. groups",
                           "Var: Group (Intercept)",
                           "Var: Group Homogeneity",
                           "Var: Group Intermediate Class ",
                           "Var: Group Working Class",
                           "Cov: Group (Intercept), Homogeneity",
                           "Cov: Group (Intercept), Intermediate Class ",
                           "Cov: Group (Intercept), Working Class",
                           "Cov: Group Homogeneity, Intermediate Class",
                           "Cov: Group Homogeneity, Working Class",
                           "Cov: Group Intermediate Class, Working Class",
                           "Var: Residual"),
       use.packages = F)
```

```{r fig4, fig.dim=c(12,7),fig.cap='Three-way interaccion effects for Redistributive Preferences, Network segregation, Social class and Income Inequality'}
### Predicted values homo*class*GiniD ---------------------------------------
# ginid_max<- round(max(dfreg$gini_disp) ,2)
# ginid_min<- round(min(dfreg$gini_disp),2)

ginid_max<- round(mean(dfreg$gini_disp) + sd(dfreg$gini_disp)  ,2)
ginid_min<- round(mean(dfreg$gini_disp) -sd(dfreg$gini_disp) ,2)
ginid_mea<- round(mean(dfreg$gini_disp),2)

df_pred_giniD_gc <-
  predictions(
    homo_V_gini_full2,newdata = datagrid(
      gini_disp = c(ginid_min, ginid_mea, ginid_max),
      wstate2=mean(dfreg$wstate2),
      loggdppercapita=mean(dfreg$loggdppercapita),
      homclass3_V_gc = seq(min(dfreg$homclass3_V_gc)+0.01, max(dfreg$homclass3_V_gc)+0.01, by=0.1),
      dclass3res_V=levels(dfreg$dclass3res_V)
    )
  )

df_pred_giniD_gc <- as.data.frame(df_pred_giniD_gc)
df_pred_giniD_gc$gini_disp <- factor(df_pred_giniD_gc$gini_disp,labels = c("Gini (-1SD)","Gini (Mean)", "Gini (+1SD)"))
df_pred_giniD_gc <- df_pred_giniD_gc %>% filter(dclass3res_V!="Intermediate class (III+IV)")

df_pred_giniD_gc %>% 
  ggplot(aes(y=estimate,x=homclass3_V_gc, fill=dclass3res_V,color=dclass3res_V,ymin=conf.low, ymax=conf.high)) +
  geom_ribbon(alpha=0.8,size=0.7,linetype="solid",color="black") +
  geom_line(size=1,color="black") +
  geom_point(size=3, shape = 21,color="black") +
  facet_wrap(~gini_disp) +
  labs(y = "Preferences for Redistribution",
       x="Network homogeneity (CWC)",
       caption = paste0("N=",nobs(homo_V_gini_full2),", Countries=",lme4::ngrps(homo_V_gini_full2))
       ) +
  scale_x_continuous(sec.axis = sec_axis(~ . , name = "Income inequality (post-tax) \n ", breaks = NULL, labels = NULL),
                     ) +
 
   scale_fill_manual(values=c("#323232","#CCCCCC"))+
  scale_color_manual(values=c("#323232","#CCCCCC"))+
  theme(legend.position = "bottom",
        legend.direction = "horizontal",
        axis.text=element_text(size=15),
        legend.title = element_blank(),
        legend.background = element_blank(),
        legend.box.background = element_rect(colour = "black"))
```

\newpage

# Discussion and conclusion

`r if (is_latex_output()) '
# References {-}
'`
```{=tex}
\scriptsize
\singlespacing
```

```{r oldcode, eval=FALSE, include=FALSE}

# homo_V_gini_gdp_tax <- 
#   lmer(egal~ 
#          homclass3_V_gc+
#          know_total_gc+
#          socialtrust_gc+
#          dclass3res_V+dclass3spo_V+
#          female_gc+agenum_gc+age2_gc+
#          edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
#          union_gc+workst_gc+
#          gini_disp +loggdppercapita + ilo_taxrev +
#          (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)
# 
# 
# homo_V_gini_gdp_govsp <- 
#   lmer(egal~ 
#          homclass3_V_gc+
#          know_total_gc+
#          socialtrust_gc+
#          dclass3res_V+dclass3spo_V+
#          female_gc+agenum_gc+age2_gc+
#          edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
#          union_gc+workst_gc+
#          gini_disp +loggdppercapita + ilo_govspe +
#          (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)
# 
# 
# homo_V_gini_gdp_redis <- 
#   lmer(egal~ 
#          homclass3_V_gc+
#          know_total_gc+
#          socialtrust_gc+
#          dclass3res_V+dclass3spo_V+
#          female_gc+agenum_gc+age2_gc+
#          edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
#          union_gc+workst_gc+
#          gini_disp +loggdppercapita + abs_red +
#          (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)
# 
# homo_V_gini_gdp_controls <-
#   lmer(egal~
#          homclass3_V_gc+
#          know_total_gc+
#          socialtrust_gc+
#          dclass3res_V+dclass3spo_V+
#          female_gc+agenum_gc+age2_gc+
#          edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
#          union_gc+workst_gc+
#          gini_disp +loggdppercapita + ilo_taxrev + ilo_govspe + abs_red +
#          (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)
# 
# 
# homo_V_gini_gdp_wstate1 <- 
#   lmer(egal~ 
#          homclass3_V_gc+
#          know_total_gc+
#          socialtrust_gc+
#          dclass3res_V+dclass3spo_V+
#          female_gc+agenum_gc+age2_gc+
#          edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
#          union_gc+workst_gc+
#          gini_disp +loggdppercapita + wstate1+
#          (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)

# homo_V_gini_full <- 
#   lmer(egal~ 
#          homclass3_V_gc+
#          know_total_gc+
#          socialtrust_gc+
#          dclass3res_V+dclass3spo_V+
#          female_gc+agenum_gc+age2_gc+
#          edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
#          union_gc+workst_gc+
#          gini_disp +loggdppercapita + ilo_taxrev + ilo_govspe + abs_red +
#          homclass3_V_gc*
#          dclass3res_V*
#          gini_disp + 
#          (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)
# 
# homo_V_gini_full1 <- 
#   lmer(egal~ 
#          homclass3_V_gc+
#          know_total_gc+
#          socialtrust_gc+
#          dclass3res_V+dclass3spo_V+
#          female_gc+agenum_gc+age2_gc+
#          edyears_gc+Q03pcm_2_gc+Q03pcm_3_gc+Q03pcm_NA_gc+
#          union_gc+workst_gc+
#          gini_disp +loggdppercapita + wstate1+
#          homclass3_V_gc*
#          dclass3res_V*
#          gini_disp + 
#          (homclass3_V_gc+dclass3res_V|country2),data=dfreg,weights = WEIGHT)
```
